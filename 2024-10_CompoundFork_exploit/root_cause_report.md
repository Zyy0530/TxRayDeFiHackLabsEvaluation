# Cross-protocol WETH Extraction via Morpho Flash Loan and CLPool/Lending Stack on Base (8453)

## Metadata

- **Report title:** Cross-protocol WETH extraction via Morpho flash loan and CLPool/lending stack on Base (8453)  
- **Chain:** Base (`chainid` 8453)  
- **Primary seed transaction:** `0x6ab5b7b51f780e8c6c5ddaf65e9badb868811a95c1fd64e86435283074d3149e`  
- **Adversary EOA:** `0x81d5187c8346073b648f2d44b9e269509513aae2`  
- **Adversary router:** `0x7562846468089cf0e8f7b38ac53406b895284901`  
- **Key protocol components:** Morpho flash loans, CLPool WETH/token AMM `0x5c45b0f48c326f79b56709d8f63ce2bee7697106`, unverified WETH market `0x5c52649d3c1e1d0ddf6a46e1c25a25d9fb148af8`, meta-lending wrapper `0xa2092f9a2a5dd84d6df7d175673ec8a7357c551b`, oracle aggregator `0x93d619623abc60a22ee71a15db62eede3ef4dd5a`, and aggregator `0x1e03834f759dac9561d366958b00fe000d9e00e3`.  
- **Root cause category:** `other` (cross-protocol economic exposure; key contracts are unverified, so behavior is not definitively classified as a single-contract logic bug).  

---

## Incident Overview & TL;DR

An unprivileged searcher-controlled EOA on Base (`0x81d5...`) deployed and used a helper router contract (`0x7562...`) to execute a large Morpho flash-loan transaction that drained WETH from a WETH lending market (`0x5c5264...`) and a verified concentrated-liquidity pool (`CLPool` `0x5c45b0...`).  

In the seed transaction (`0x6ab5...`), the router borrows 800 WETH from Morpho via `flashLoan`, routes the WETH and a secondary token (`0xb0505e5a...`) through a combination of lending, oracle, and AMM contracts, and then repays the full 800 WETH to Morpho. After the transaction:

- CLPool `0x5c45b0...` and the WETH market `0x5c5264...` have a combined net WETH loss of **256.054617598590406175 WETH**, and  
- The adversary-controlled router `0x7562...` holds the corresponding WETH gain plus a portfolio of ERC20 balances.  

Subsequent transactions from the same EOA call a `WithdrawToken` function on the router to transfer these ERC20 balances from the router to the EOA, realizing the profit while never holding the flash-loaned WETH directly in the EOA.  

The root cause is a cross-protocol composition between:

- Morpho flash loans,  
- An unverified WETH lending/borrowing stack (`0x5c5264...` + `0xa209...`),  
- An unverified oracle/aggregator (`0x93d6...` + `0x1e03...`), and  
- A concentrated-liquidity AMM (CLPool `0x5c45b0...`),  

which together admit a transaction path that is permissionless, passes all on-chain checks, repays the flash loan, yet leaves the adversary with positive WETH and token balances funded by the lending market and CLPool. Because the key lending/oracle contracts are unverified and complex, the analysis does not attribute this to a single obvious code bug and therefore classifies it as an “other” cross-protocol economic exposure rather than a clearly-identifiable logic error in one contract.

---

## Key Background

- **Morpho flash loans are simple and symmetric.**  
  A local verified Morpho deployment (`0xbbbbbbbbbb9cc5e90e3b3af64bdaf62c37eeffcb`) on Base provides flash loans by transferring the requested tokens to the caller, invoking a callback, and then requiring the same amount of tokens to be transferred back. There is no minting of extra tokens and no protocol-side fee baked into the flash loan itself, so any profit must come from what the callback (here, the router `0x7562...`) does with the borrowed funds.

- **CLPool is a standard concentrated-liquidity AMM.**  
  CLPool (`0x5c45b0f4...`) has verified source (`CLPool.sol`) and implements a concentrated-liquidity AMM between WETH (`0x4200...06`) and token `0xb0505e5a99abd03d94a1169e638b78edfed26ea4`. Its swap logic follows a Uniswap v3-style design: it moves the price along a curve based on available liquidity and does not incorporate external oracle caps or cross-protocol collateral constraints.

- **The WETH lending/oracle stack is unverified but behaves like a Compound-style system.**  
  The contracts `0x5c5264...` (WETH market), `0xa209...` (meta-lending wrapper), `0x93d6...` (price/oracle aggregator), and `0x1e03...` (aggregator used via `delegatecall`) are unverified. Disassemblies and address-txlist artifacts show:
  - Compound-style functions such as `mint`, `borrow`, and `_setPendingAdmin` on `0x5c5264...`/`0xa209...`.  
  - An oracle aggregator `0x93d6...` that maps cToken-like markets (including `0xa209...`) to feeds via `setFeed(cToken, feed)`, indicating a Compound-style oracle configuration.  

- **Router `0x7562...` is an adversary-controlled helper.**  
  Address-txlist artifacts for `0x7562...` show it was deployed by EOA `0x81d5...` and then used as:
  - The direct target of the seed flash-loan transaction (`methodId 0x25125413`), and  
  - The target of multiple `WithdrawToken` calls (`methodId 0x5c4c9f6f`) that move ERC20 balances from the router to the EOA.

---

## Vulnerability & Root Cause Analysis

### Vulnerability Summary

The deployed combination of:

- Morpho flash loans (`0xbbbbbb...`),  
- An unverified WETH market (`0x5c5264...`) and meta-lending wrapper (`0xa209...`),  
- An oracle aggregator (`0x93d6...` + `0x1e03...`), and  
- CLPool WETH/token AMM (`0x5c45b0...`),  

exposes a transaction sequence in which:

1. A router contract obtains 800 WETH from Morpho via `flashLoan`.  
2. The router routes WETH and token `0xb0505e5a...` through the CLPool and the lending/oracle stack.  
3. All protocol-level checks (oracle-based health, liquidity, etc.) pass.  
4. The router repays the full 800 WETH to Morpho.  
5. CLPool `0x5c45b0...` and the WETH market `0x5c5264...` end up with a net WETH deficit totaling **256.054617598590406175 WETH**, while the router holds a matching WETH surplus and additional ERC20 balances.  

This creates a deterministic, permissionless profit opportunity for any searcher who can replicate the call sequence. The vulnerability is structural and cross-protocol: no privileged roles are used, and the flash loan is correctly repaid.

### Evidence: Morpho Flash Loan Semantics

Origin: collected contract source (`Morpho.sol`) for Morpho `0xbbbbbb...` (verified local project).

```solidity
/// @inheritdoc IMorphoBase
function flashLoan(address token, uint256 assets, bytes calldata data) external {
    require(assets != 0, ErrorsLib.ZERO_ASSETS);

    emit EventsLib.FlashLoan(msg.sender, token, assets);

    IERC20(token).safeTransfer(msg.sender, assets);

    IMorphoFlashLoanCallback(msg.sender).onMorphoFlashLoan(assets, data);

    IERC20(token).safeTransferFrom(msg.sender, address(this), assets);
}
```

*Caption: Morpho simply transfers `assets` tokens to the caller, executes the callback, and requires the same `assets` back; any net gain must come from what the callback does elsewhere, not from Morpho’s own accounting.*

### Evidence: CLPool Swap and Flash Behavior

Origin: collected CLPool implementation (`CLPool.sol`) for `0x5c45b0...` (verified concentrated-liquidity AMM).

```solidity
function swap(
    address recipient,
    bool zeroForOne,
    int256 amountSpecified,
    uint160 sqrtPriceLimitX96,
    bytes calldata data
) external override returns (int256 amount0, int256 amount1) {
    require(amountSpecified != 0, "AS");
    // ...
    // do the transfers and collect payment
    if (zeroForOne) {
        if (amount1 < 0) TransferHelper.safeTransfer(token1, recipient, uint256(-amount1));

        uint256 balance0Before = balance0();
        ICLSwapCallback(msg.sender).uniswapV3SwapCallback(amount0, amount1, data);
        require(balance0Before.add(uint256(amount0)) <= balance0(), "IIA");
    } else {
        if (amount0 < 0) TransferHelper.safeTransfer(token0, recipient, uint256(-amount0));

        uint256 balance1Before = balance1();
        ICLSwapCallback(msg.sender).uniswapV3SwapCallback(amount0, amount1, data);
        require(balance1Before.add(uint256(amount1)) <= balance1(), "IIA");
    }

    emit Swap(msg.sender, recipient, amount0, amount1, state.sqrtPriceX96, state.liquidity, state.tick);
    slot0.unlocked = true;
}
```

*Caption: CLPool enforces that the AMM is repaid according to its curve (`IIA` checks) but does not enforce any external oracle or collateral constraints, allowing it to be used as a pure price source in a larger lending/oracle system.*

### Evidence: Seed Flash-Loan Transaction Flow

Origin: seed transaction trace (`cast run -vvvvv`) for seed tx `0x6ab5...` on Base 8453.

```text
[11025626] 0x7562846468089Cf0e8f7b38AC53406b895284901::25125413(...)
  ├─ [11017146] 0xBBBBBbbBBb9cC5e90e3b3Af64bdAF62C37EEFFCb::flashLoan(WETH9: [0x4200...06], 800000000000000000000 [8e20], 0x)
  │   ├─ emit FlashLoan(param0: 0x7562..., param1: WETH9: [0x4200...06], param2: 800000000000000000000 [8e20])
  │   ├─ [29701] WETH9::transfer(0x7562..., 800000000000000000000 [8e20])
  │   ├─ [10974848] 0x7562...::onMorphoFlashLoan(800000000000000000000 [8e20], 0x)
  │   │   ├─ 0x5c5264...::mint(15000000000000000000 [1.5e19])
  │   │   ├─ ... calls into 0xa209..., 0x93d6..., 0x1e03..., CLPool 0x5c45b0..., and a UniswapV2-style router ...
  │   └─ ...
```

*Caption: The seed trace shows the router `0x7562...` borrowing 800 WETH from Morpho, entering the WETH market `0x5c5264...`, the meta-lending wrapper `0xa209...`, oracle aggregator `0x93d6...`, aggregator `0x1e03...`, and CLPool `0x5c45b0...`, orchestrating a complex series of mints, borrows, and swaps before repaying the flash loan.*

### Evidence: Net WETH Movement from Lending/CLPool Stack to Router

Origin: prestate-based balance diff for seed tx (`balance_diff.json` under the seed directory).

```json
{
  "erc20_transfers": [
    {
      "token": "0x4200000000000000000000000000000000000006",
      "from": "0xbbbbbbbbbb9cc5e90e3b3af64bdaf62c37eeffcb",
      "to": "0x7562846468089cf0e8f7b38ac53406b895284901",
      "value": "800000000000000000000"
    },
    {
      "token": "0x4200000000000000000000000000000000000006",
      "from": "0x7562846468089cf0e8f7b38ac53406b895284901",
      "to": "0x5c52649d3c1e1d0ddf6a46e1c25a25d9fb148af8",
      "value": "15000000000000000000"
    },
    {
      "token": "0x4200000000000000000000000000000000000006",
      "from": "0x1e03834f759dac9561d366958b00fe000d9e00e3",
      "to": "0x5c45b0f48c326f79b56709d8f63ce2bee7697106",
      "value": "349328414132549562200"
    },
    {
      "token": "0x4200000000000000000000000000000000000006",
      "from": "0x5c52649d3c1e1d0ddf6a46e1c25a25d9fb148af8",
      "to": "0x1e03834f759dac9561d366958b00fe000d9e00e3",
      "value": "262435971398571237348"
    }
    // ... additional entries omitted
  ]
}
```

*Caption: The balance diff shows 800 WETH flowing from Morpho to the router, then WETH moving between the router, the WETH market `0x5c5264...`, the aggregator `0x1e03...`, and CLPool `0x5c45b0...`, ultimately leaving CLPool and the WETH market with a combined net WETH loss of 256.054617598590406175 WETH and the router with a matching WETH gain after the flash loan is repaid.*

### Structural Root Cause

Within the seed transaction:

- The router `0x7562...` acts as Morpho’s flash-loan callback and is free to call any combination of lending, oracle, and AMM contracts.  
- The lending/oracle stack (`0x5c5264...` + `0xa209...` + `0x93d6...` + `0x1e03...`) treats the router as a borrower, performs interest accrual and health checks, and permits a sequence of borrows and transfers that ultimately leave the WETH market with a large WETH deficit while considering the loan “healthy”.  
- CLPool `0x5c45b0...` is used as an on-chain price source and liquidity venue for WETH/token `0xb0505e5a...` swaps; its internal invariants are maintained, but it loses WETH reserves as part of the broader loop.  
- Morpho itself is fully repaid and ends the transaction flat in WETH, meaning Morpho’s own accounting and flash-loan invariants hold.

Disassembly of the unverified contracts shows:

- Aggregator contract `0x1e03...` prepares calldata (selector `0xfc57d4df`) to `0xa209...`, passing WETH, the router address, timestamps, and constants, which is consistent with constructing or consuming WETH-denominated prices based on the CLPool WETH/token pair.  
- `0x93d6...` behaves as a Compound-style oracle aggregator, queried via `getUnderlyingPrice` for `0xa209...` during `borrowAllowed`, indicating that the lending stack’s health checks rely on this oracle configuration.  

Because source code for `0x5c5264...`, `0xa209...`, `0x93d6...`, and `0x1e03...` is unavailable, the analysis does not pinpoint a single storage bug (e.g., mis-scaled price, faulty health check, or accounting error). Instead, the evidence supports the conclusion that the *composition* of:

- A flash-loan-enabled borrower (the router),  
- An oracle-driven lending stack that accepts on-chain AMM prices, and  
- The CLPool price path,  

creates a deterministic, economically exploitable path where the borrower can engineer a profitable cycle that is acceptable to each individual contract but results in permanent WETH outflow from the lending/CLPool stack to the adversary.

### Vulnerable Components

Based on the observed flows and configuration:

- **CLPool WETH/token AMM**  
  - Address: `0x5c45b0f48c326f79b56709d8f63ce2bee7697106` (Base 8453)  
  - Role: Provides WETH/token liquidity and defines the WETH/token price path used by the lending/oracle stack.  

- **Unverified WETH lending market and meta-lending wrapper**  
  - WETH market (`cToken-like`): `0x5c52649d3c1e1d0ddf6a46e1c25a25d9fb148af8` (Base 8453)  
  - Meta-lending wrapper: `0xa2092f9a2a5dd84d6df7d175673ec8a7357c551b` (Base 8453)  
  - Role: Holds user or protocol WETH deposits and issues borrowable positions; interacts with the oracle aggregator for price and health checks.  

- **Oracle aggregator**  
  - Address: `0x93d619623abc60a22ee71a15db62eede3ef4dd5a` (Base 8453)  
  - Role: Maps cToken-like markets (including `0xa209...`) to price feeds, providing the prices used to determine borrower health.  

- **Aggregator/coordination contract**  
  - Address: `0x1e03834f759dac9561d366958b00fe000d9e00e3` (Base 8453)  
  - Role: Used via `delegatecall` by router `0x7562...` to coordinate the succession of calls to the oracle, lending markets, and CLPool in the flash-loan callback.  

### Exploit Preconditions

The observed exploit requires at least the following conditions to hold:

- **Morpho flash-loan availability.**  
  Morpho `0xbbbbbb...` must remain deployed with a flash-loan API capable of lending 800 WETH to any caller implementing `IMorphoFlashLoanCallback`.

- **Lending/oracle configuration that permits the borrow path.**  
  The WETH market `0x5c5264...` and meta-lending wrapper `0xa209...`, together with the oracle stack `0x93d6...` and aggregator `0x1e03...`, must consider the router sufficiently healthy to allow the mint/borrow flows and token transfers seen in the seed trace without reverting, even though these flows result in a large net WETH deficit on the WETH market.

- **CLPool liquidity and price path.**  
  CLPool `0x5c45b0...` must have sufficient WETH and token `0xb0505e5a...` liquidity to execute the swaps used in the seed transaction at the implied on-chain price, without hitting price-limit checks or reverting due to insufficient liquidity.

- **Permissionless access.**  
  All involved contracts (Morpho, router `0x7562...`, `0x1e03...`, `0x5c5264...`, `0xa209...`, `0x93d6...`, `0x5c45b0...`) must be callable by an unprivileged EOA under normal gas and fee conditions. The traces show only public functions and standard ERC20 operations; no privileged roles are used in the exploit sequence.

### Security Principles Violated

- **Over-reliance on a single AMM price source for lending collateral checks.**  
  The lending market’s health and borrow checks depend (directly or indirectly) on CLPool’s on-chain WETH/token price without additional guardrails, enabling deterministic value extraction via flash-loan cycles that exploit the AMM price path.

- **Lack of isolation between oracle-driven lending and composable AMM liquidity.**  
  The system allows a sophisticated searcher to route flash-loaned funds through a path that passes all contract-level checks yet leaves lending and liquidity contracts with net asset losses while the flash loan is fully repaid and the adversary ends with a strictly positive multi-token position.

---

## Adversary Flow Analysis

### Adversary Strategy Summary

The adversary’s overall strategy consists of:

1. Deploying a helper router contract `0x7562...` under their EOA `0x81d5...`.  
2. Using that router as the Morpho flash-loan callback to construct a profitable WETH/token position on the router via a single complex transaction through the lending/oracle/CLPool stack.  
3. Following up with a series of simple `WithdrawToken` calls that transfer the router’s ERC20 balances to the EOA, realizing profit in multiple tokens without ever directly holding the flash-loaned WETH in the EOA.

### Adversary Cluster and Victim Candidates

- **Adversary EOA (`0x81d5...`).**  
  - Chain: Base (8453)  
  - Role:  
    - Sender of the seed flash-loan tx `0x6ab5...`.  
    - Sender of all observed `WithdrawToken` calls (`methodId 0x5c4c9f6f`).  
    - Recipient of the token transfers from the router in the withdraw transactions.  

- **Adversary router (`0x7562...`).**  
  - Chain: Base (8453)  
  - Role:  
    - Deployed by EOA `0x81d5...`.  
    - Direct `to` address of the seed flash-loan transaction and all `WithdrawToken` calls.  
    - Holds the intermediate WETH and ERC20 balances, then transfers them out to the EOA.  

- **Victim-side contracts (balance losers / risk bearers).**  
  - CLPool WETH/`0xb0505e5a...` pool (`0x5c45b0...`, verified).  
  - Unverified WETH market (`0x5c5264...`, cToken-like).  
  - Meta-lending wrapper (`0xa209...`).  
  - Lending/oracle aggregator (`0x93d6...`).  
  These contracts collectively end the seed transaction with reduced WETH balances (for CLPool and the WETH market) relative to pre-state and are the ultimate sources of the adversary’s WETH profit.

### Evidence: Router Deployment and Use as Helper

Origin: router address-txlist for `0x7562...` (transactions_by_address JSON, Base 8453).

```json
{
  "hash": "0x196ee1330443b37c8a9f00bfa62adc41a33498b49e5093f2b3dcb771c5d2842e",
  "from": "0x81d5187c8346073b648f2d44b9e269509513aae2",
  "to": "",
  "input": "0x6080604052...",
  "contractAddress": "0x7562846468089cf0e8f7b38ac53406b895284901",
  "txreceipt_status": "1"
}
```

*Caption: The creation transaction `0x196e...` shows EOA `0x81d5...` deploying the router `0x7562...`, confirming that the router is adversary-controlled.*

The same address-txlist shows subsequent calls from the same EOA to the router:

```json
{
  "hash": "0x6ab5b7b51f780e8c6c5ddaf65e9badb868811a95c1fd64e86435283074d3149e",
  "from": "0x81d5...",
  "to": "0x7562...",
  "methodId": "0x25125413"
},
{
  "hash": "0x176a09ea8fa1d2ee74998e9181e8960c276e94b4b87702bce7c17be8ee2ffd8b",
  "from": "0x81d5...",
  "to": "0x7562...",
  "methodId": "0x5c4c9f6f"
}
// ... additional 0x5c4c9f6f WithdrawToken calls
```

*Caption: The address-txlist links the seed flash-loan invocation and all WithdrawToken calls to the same EOA and router, tying together the multi-stage exploit lifecycle.*

### Lifecycle Stage 1: Router Deployment and Setup

- **Transaction:** `0x196ee1330443b37c8a9f00bfa62adc41a33498b49e5093f2b3dcb771c5d2842e`  
- **Block:** 21512037 (Base 8453)  
- **Mechanism:** Contract deployment (`input` starts with `0x60806040...`)  

Effect:

- EOA `0x81d5...` deploys router `0x7562...`, which will later serve both as:
  - The Morpho flash-loan callback, and  
  - The holder of intermediate WETH and ERC20 balances prior to withdrawal to the EOA.

### Lifecycle Stage 2: Flash-Loan WETH Extraction via Lending/Oracle/CLPool Stack

- **Transaction:** Seed tx `0x6ab5b7b51f780e8c6c5ddaf65e9badb868811a95c1fd64e86435283074d3149e`  
- **Block:** 21512063 (Base 8453)  
- **Mechanism:** `flashLoan + lending + swaps`  

Key observations from the trace and state diff:

- The router calls Morpho’s `flashLoan` and receives 800 WETH.  
- The router interacts with the WETH market `0x5c5264...`, meta-lending wrapper `0xa209...`, and oracle aggregator `0x93d6...` (via `borrowAllowed`, `getUnderlyingPrice`, etc.), passing health checks that consider token prices derived from CLPool.  
- The router routes WETH/token `0xb0505e5a...` through CLPool `0x5c45b0...`, using on-chain liquidity to realize a favorable price path.  
- At the end of the callback, the router repays 800 WETH to Morpho, satisfying the flash-loan invariants, but the balance diff shows:
  - CLPool `0x5c45b0...` and WETH market `0x5c5264...` have a combined WETH loss of 256.054617598590406175 WETH.  
  - The router `0x7562...` has a matching WETH gain plus large ERC20 balances.  

This stage constructs a profitable multi-token position on the router while leaving the flash-loan provider flat.

### Lifecycle Stage 3: Withdraw ERC20 Balances from Router to EOA

- **Transactions:**  
  - `0x176a09ea8fa1d2ee74998e9181e8960c276e94b4b87702bce7c17be8ee2ffd8b` (wrapped asset via BeaconProxy)  
  - `0x0a2dab1ef05ed4308e010362faad7e4da01317067cac7e80298c5d6af0d82404` (OptimismMintableERC20)  
  - `0x72b98b0f07f13e53fffc33dee93d3b52aafffd87b417c1a0d56fb3583577da30` (BrettToken)  
  - `0xaf85c3bd1a237c9decbe14b27e915c5596cdfd82a97df2fe67012d40239c3002`  
  - `0xaa9decc8868f3b01600bc7aa548ada1ea5a4aa623c02b84b96087299401d02ec`  
  - `0xbae5bdb6e92f443100b80fcb0f0c9515ae7a43a66c4a549e4b1db1abbea648bf`  

All of these are `WithdrawToken` calls (`methodId 0x5c4c9f6f`) from EOA `0x81d5...` to router `0x7562...`.

Evidence example (OptimismMintableERC20 withdraw, tx `0x0a2d...`):

Origin: iter_3 transaction trace for `0x0a2d...` (OptimismMintableERC20 withdrawal).

```text
Traces:
  [37051] 0x7562846468089Cf0e8f7b38AC53406b895284901::WithdrawToken(OptimismMintableERC20: [0x2Da56AcB9Ea78330f947bD57C54119Debda7AF71])
    ├─ [2562] OptimismMintableERC20::balanceOf(0x7562...) [staticcall]
    │   └─ ← [Return] 40573948868634870971110344139 [4.057e28]
    ├─ [27876] OptimismMintableERC20::transfer(0x81d5..., 40573948868634870971110344139 [4.057e28])
    │   ├─ emit Transfer(from: 0x7562..., to: 0x81d5..., value: 40573948868634870971110344139 [4.057e28])
    │   └─ ← [Return] true
    └─ ← [Stop]
```

*Caption: In tx `0x0a2d...`, the router transfers its entire OptimismMintableERC20 balance to the EOA, using only standard `balanceOf` and `transfer` calls with no special permissions; analogous traces exist for other tokens in the withdraw series.*

Across these withdraw transactions:

- The router is systematically drained of ERC20 balances accumulated during the seed flash-loan transaction.  
- The EOA `0x81d5...` receives large balances of multiple tokens (e.g., wrapped assets via BeaconProxy, OptimismMintableERC20, BrettToken, and others).  
- The cluster’s net WETH position is determined by the earlier seed transaction; the withdraws primarily move non-WETH tokens from the router to the EOA.

---

## Impact & Losses

### Quantitative Impact

From the perspective of the contracts involved in the flash-loan cycle:

- **WETH (Base WETH9 `0x4200...06`).**  
  - CLPool `0x5c45b0...` WETH balance decreases by approximately **8.618646200019168827 WETH**.  
  - WETH market `0x5c5264...` WETH balance decreases by approximately **247.435971398571237348 WETH**.  
  - Combined WETH loss from CLPool + WETH market: **256.054617598590406175 WETH**.  
  - Morpho’s WETH balance is unchanged after repayment of the 800 WETH flash loan.  
  - The adversary-controlled router `0x7562...` holds a corresponding WETH gain plus large balances of several ERC20 tokens, which are then withdrawn to EOA `0x81d5...` in subsequent transactions.

### Attribution and Limitations

- It is clear from the on-chain state diffs and traces that there is a deterministic, fee-positive value transfer from the WETH market and CLPool into the adversary cluster (router + EOA).  
- Due to the lack of verified source for the WETH market `0x5c5264...`, meta-lending wrapper `0xa209...`, oracle aggregator `0x93d6...`, and aggregator `0x1e03...`, this analysis does **not** determine how these losses are distributed between end users, protocol-owned liquidity, or other participants.  
- The classification of the root cause as **“other”** reflects this limitation: the behavior is economically harmful and reproducible but cannot be decisively labeled as a bug in a single contract versus an intended yet exploitable cross-protocol configuration.

---

## References

- **[1] Seed transaction trace (`cast run -vvvvv`) for tx `0x6ab5...` on Base 8453.**  
  Shows the full internal call graph for the flash-loan transaction, including Morpho.flashLoan, lending/oracle calls, CLPool swaps, and ERC20 transfers that match the balance diff.

- **[2] Seed transaction balance diff (`balance_diff.json`) for tx `0x6ab5...`.**  
  Provides prestate-based native and ERC20 balance deltas, confirming the net WETH losses on CLPool `0x5c45b0...` and WETH market `0x5c5264...` and the corresponding WETH gain on router `0x7562...`.

- **[3] Morpho flash-loan implementation (`Morpho.sol`).**  
  Verified local source for Morpho `0xbbbbbb...`, demonstrating that the flash-loan logic is symmetric and that Morpho ends flat in WETH after the exploit sequence.

- **[4] CLPool concentrated-liquidity pool source (`CLPool.sol`).**  
  Verified AMM implementation for `0x5c45b0...`, used to understand swap behavior and confirm that CLPool enforces its own invariants but not cross-protocol collateral checks.

- **[5] Disassembly for aggregator/coordination contract `0x1e03...`.**  
  Used to understand how the router, lending contracts, and CLPool are orchestrated during the flash-loan callback.

- **[6] Disassemblies for WETH market `0x5c5264...`, meta-lending contract `0xa209...`, and oracle aggregator `0x93d6...`.**  
  Show Compound-style lending/oracle patterns and confirm the roles of these unverified contracts in the exploit path.

- **[7] Router `0x7562...` address-txlist (Base 8453).**  
  Links the router’s deployment, the seed flash-loan transaction, and the series of WithdrawToken calls, tying them to EOA `0x81d5...`.

- **[8] WithdrawToken transaction traces (`trace.cast.log`) for txs `0x176a...`, `0xbae5...`, `0x0a2d...`, `0x72b9...`, `0xaf85...`, `0xaa9d...`.**  
  Show router `0x7562...` performing permissionless ERC20 `balanceOf` and `transfer` calls to move its aggregated token balances to EOA `0x81d5...`, completing the exploit lifecycle.

